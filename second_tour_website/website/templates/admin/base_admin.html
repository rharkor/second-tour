{% extends "base.html" %}
{% block head %}
<link rel="stylesheet" href="{{url_for('static', filename='admin.css')}}">
{% endblock %}
{% block content %}
<div class="d-flex flex-column vh-100 flex-shrink-0 p-3 text-white bg-dark"
    style="position: fixed; width: 250px; height: 100% !important;">
    <a href="{{url_for('admin_routes.acceuil')}}"
        class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
        <svg class="bi me-2" width="40" height="32"></svg>
        <span class="fs-4">Espace admin</span>
    </a>
    <hr>
    <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
            <a href="{{url_for('admin_routes.acceuil')}}" {% if request.url_rule.endpoint=="admin_routes.acceuil"
                %}class="nav-link active" aria-current="page" {% else %}class="nav-link text-white" {% endif %}>
                <i class="fas fa-home"></i>
                <span class="ms-2">Acceuil</span>
            </a>
        </li>
        <li>
            <a href="{{url_for('admin_routes.salles')}}" {% if request.url_rule.endpoint=="admin_routes.salles"
                %}class="nav-link active" aria-current="page" {% else %}class="nav-link text-white" {% endif %}>
                <i class="fas fa-chalkboard-teacher"> </i>
                <span class="ms-2">Salles</span>
            </a>
        </li>
        <li>
            <a href="{{url_for('admin_routes.series')}}" {% if request.url_rule.endpoint=="admin_routes.series"
                %}class="nav-link active" aria-current="page" {% else %}class="nav-link text-white" {% endif %}>
                <i class="fas fa-vial"></i>
                <span class="ms-2">Séries</span>
            </a>
        </li>
        <li>
            <a href="{{url_for('admin_routes.matieres')}}" {% if request.url_rule.endpoint=="admin_routes.matieres"
                %}class="nav-link active" aria-current="page" {% else %}class="nav-link text-white" {% endif %}>
                <i class="fas fa-bookmark"></i>
                <span class="ms-2">Matières</span>
            </a>
        </li>
        <li>
            <a href="{{url_for('admin_routes.candidats')}}" {% if request.url_rule.endpoint=="admin_routes.candidats"
                %}class="nav-link active" aria-current="page" {% else %}class="nav-link text-white" {% endif %}>
                <i class="fas fa-users"></i>
                <span class="ms-2">Candidats</span>
            </a>
        </li>
        <li>
            <a href="{{url_for('admin_routes.professeurs')}}" {% if
                request.url_rule.endpoint=="admin_routes.professeurs" %}class="nav-link active" aria-current="page" {%
                else %}class="nav-link text-white" {% endif %}>
                <i class="fas fa-user-tie"></i>
                <span class="ms-2">Professeurs</span>
            </a>
        </li>
        <hr>
        <li>
            <a href="{{url_for('admin_routes.creneau')}}" {% if request.url_rule.endpoint=="admin_routes.creneau"
                %}class="nav-link active" aria-current="page" {% else %}class="nav-link text-white" {% endif %}>
                <i class="fas fa-calendar-alt"></i>
                <span class="ms-2">Créneau</span>
            </a>
        </li>
        <li>
            <a href="{{url_for('admin_routes.comptes')}}" {% if request.url_rule.endpoint=="admin_routes.comptes"
                %}class="nav-link active" aria-current="page" {% else %}class="nav-link text-white" {% endif %}>
                <i class="fas fa-user-circle"></i>
                <span class="ms-2">Comptes</span>
            </a>
        </li>
    </ul>
    <hr>
    <div class="dropdown">
        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser1"
            data-bs-toggle="dropdown" aria-expanded="false">
            <strong>{{session['email']}}</strong>
        </a>
        <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdownUser1">
            <li>
                <a class="dropdown-item" href="{{url_for('admin_routes.deconnexion')}}">Se déconnecter</a>
            </li>
        </ul>
    </div>
</div>
<div class="d-flex flex-column vh-100 flex-shrink-0 p-3 text-white bg-dark"
    style=" width: 250px; height: 100% !important;"></div>
{% block sub_content %}
{% endblock %}
{% endblock %}


{% block script %}
<script>
    $('.deleteRow').click(function () {
        var $myRowId = $(this).get(0).id;
        name = document.getElementById("ModalSubmitButton").getAttribute("form");
        $("#ModalSubmitButton").attr('form', name + $myRowId);
    });
</script>
<script>
    function downloadPDFWithBrowserPrint(name, num_salle, output = false) {
        var doc = new jsPDF('l', 'pt', 'a4');
        var htmlstring = '';
        var tempVarToCheckPageHeight = 0;
        var pageHeight = 0;

        pageHeight = doc.internal.pageSize.height;
        specialElementHandlers = {
            // element with id of "bypass" - jQuery style selector  
            '#bypassme': function (element, renderer) {
                // true = "handled elsewhere, bypass text extraction"  
                return true
            }
        };
        margins = {
            top: 150,
            bottom: 60,
            left: 40,
            right: 40,
            width: 600
        };
        doc.setFontSize(10);
        doc.setLineWidth(4);
        doc.text(20, 20, 'Salle : ' + num_salle.toString());
        //doc.text(200, y = y + 30, "Liste d'émargement");
        doc.setFontSize(20);
        centered_text("Liste d'émargement", 60, doc);
        doc.autoTable({
            html: '#' + name,
            startY: 70,
            theme: 'grid',
            columnStyles: {
                0: {
                    cellWidth: 140,
                },
                1: {
                    cellWidth: 140,
                },
                2: {
                    cellWidth: 140,
                },
                3: {
                    cellWidth: 140,
                },
            },
            styles: {
                minCellHeight: 40
            }
        })

        if (!output) {
            doc.save(num_salle.toString() + '_listeDEmargement.pdf');
        } else {
            return doc;
        }

    }

    function download_multiplePdf() {
        var zip = new JSZip();

        var all_salles = JSON.parse('{{all_salles|tojson}}');
        var all_professeurs = JSON.parse('{{all_professeurs|tojson}}');

        for (let i = 0; i < all_salles.length; i++) {
            var salle = all_salles[i];
            var doc = downloadPDFWithBrowserPrint('tableAccordion' + salle.id_salle.toString(), salle.numero, true);
            try {
                zip.file(salle.numero.toString() + '_listeDEmargement.pdf', doc.output('blob'));
            }
            catch {
                console.error('Something went wrong!');
            }
        }
        zip.generateAsync({ type: 'blob' }).then(function (content) {
            saveAs(content, 'listesDEmargement.zip');
        });
    }

    function centered_text(text, y, doc) {
        var textWidth = doc.getStringUnitWidth(text) * doc.internal.getFontSize() / doc.internal.scaleFactor;
        var textOffset = (doc.internal.pageSize.width - textWidth) / 2;
        doc.text(textOffset, y, text);
    }
</script>
{% block sub_script %}
{% endblock %}
{% endblock %}